

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The Audio-Video Overlay &mdash; Python on Zynq (Pynq) v1.0</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Python on Zynq (Pynq) v1.0" href="index.html"/>
        <link rel="next" title="IO Processors: Writing your own software" href="8_iop_code.html"/>
        <link rel="prev" title="Peripherals and the Pmod I/O overlay" href="6_pmodio_overlay.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Python on Zynq (Pynq)
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1_pynq.html">Pynq Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_jupyter_notebook.html">Introduction to Jupyter Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_programming_zybo_in_python.html">Cortex-A9 programming in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_programming_onboard_peripherals.html">Programming Zybo&#8217;s onboard peripherals</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_pmodio_overlay.html">Peripherals and the Pmod I/O overlay</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The Audio-Video Overlay</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Video-IO">Video IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="#The-HDMI-video-capture-controller">The HDMI video capture controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Starting-and-stopping-the-controller">Starting and stopping the controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Readback-from-the-controller">Readback from the controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#HDMI-Frame-buffer">HDMI Frame buffer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Access-the-current-frame">Access the current frame</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#The-VGA-video-display-controller">The VGA video display controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Frame-Buffers">Frame Buffers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-HDMI-and-VGA-in-combination">Using HDMI and VGA in combination</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-Audio-IO">Using Audio IO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="8_iop_code.html">IO Processors: Writing your own software</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_creating_overlays.html">Working with Overlays</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_libraries_and_overlays.html">The <code class="docutils literal"><span class="pre">Pynq</span></code> (Python on Zynq) Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_verification.html">Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_modules.html">pynq modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_faqs.html">Frequently Asked Questions (FAQs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_references.html">Useful Reference Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Python on Zynq (Pynq)</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>The Audio-Video Overlay</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/7_audio_video_overlay.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<div class="section" id="The-Audio-Video-Overlay">
<h1>The Audio-Video Overlay<a class="headerlink" href="#The-Audio-Video-Overlay" title="Permalink to this headline">¶</a></h1>
<p>The audio video overlay contains a HDMI video capture controller, a VGA
video display controller, an audio controller that connects to the
Headphone (HPH) and the Line In ports on the board, and a single IO
Processor connected to Pmod Port 1.</p>
<div class="figure">
<img alt="" src="_images/zyboaudiovideo.jpg" />
</div>
<p>The IO Processor is the same as in the Pmod I/O overlay. Please refer to
the <a class="reference external" href="6_pmodio_overlay.html">Pmod I/O overlay</a> for more information
about the IO Processor.</p>
<div class="section" id="Video-IO">
<h2>Video IO<a class="headerlink" href="#Video-IO" title="Permalink to this headline">¶</a></h2>
<p>The overlay contains two video controllers, video input (HDMI), and
video output (VGA). Both interfaces can be controlled independently, or
used in combination to capture an image on the HDMI and display it on
the VGA.</p>
</div>
<div class="section" id="The-HDMI-video-capture-controller">
<h2>The HDMI video capture controller<a class="headerlink" href="#The-HDMI-video-capture-controller" title="Permalink to this headline">¶</a></h2>
<p>To use the HDMI in controller, connect the on-board HDMI port to a valid
video source. E.g. your laptop can be used if it has HDMI out. Any HDMI
video source can be used up to 1080p.</p>
<p>To use the HDMI in, ensure you have connected a valid HDMI source and
execute the next cell. If a valid HDMI source is not detected, the
kernel will hang and restart.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [1]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq</span> <span class="k">import</span> <span class="n">Overlay</span>
<span class="kn">from</span> <span class="nn">pynq.video</span> <span class="k">import</span> <span class="n">HDMI</span>

<span class="c"># Download new bitstream with audiovideo IP</span>
<span class="n">Overlay</span><span class="p">(</span><span class="s">&quot;audiovideo.bit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>

<span class="c"># Initialize HDMI as an input device</span>
<span class="n">hdmi</span> <span class="o">=</span> <span class="n">HDMI</span><span class="p">(</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The HDMI() argument ‘in’ indicates that the object is in capture mode.
Currently, this is the only supported mode for HDMI.</p>
<p>When a valid video input source is connected, the controller should
recognize it and start automatically.</p>
</div>
<div class="section" id="Starting-and-stopping-the-controller">
<h2>Starting and stopping the controller<a class="headerlink" href="#Starting-and-stopping-the-controller" title="Permalink to this headline">¶</a></h2>
<p>You can manually start/stop the controller</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [2]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">hdmi</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [4]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">hdmi</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Readback-from-the-controller">
<h2>Readback from the controller<a class="headerlink" href="#Readback-from-the-controller" title="Permalink to this headline">¶</a></h2>
<p>To check the state of the controller:</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [5]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">state</span> <span class="o">=</span> <span class="n">hdmi</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<p>The state is returned as an integer value, with one of 3 possible
values:</p>
<ul class="simple">
<li>0 if disconnected</li>
<li>1 if streaming</li>
<li>2 if paused</li>
</ul>
<p>You can also check the width and height of the input source (assuming a
source is connected):</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [6]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">width</span> <span class="o">=</span> <span class="n">hdmi</span><span class="o">.</span><span class="n">frame_width</span><span class="p">()</span>
<span class="n">height</span> <span class="o">=</span> <span class="n">hdmi</span><span class="o">.</span><span class="n">frame_height</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&#39;HDMI is capturing a video source of resolution {}x{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
HDMI is capturing a video source of resolution 1920x1080
</pre></div></div>
</div>
</div>
<div class="section" id="HDMI-Frame-buffer">
<h2>HDMI Frame buffer<a class="headerlink" href="#HDMI-Frame-buffer" title="Permalink to this headline">¶</a></h2>
<p>The HDMI object holds a frame buffer, that can contain up to 3 frames,
and is where the controller stores the captured frames. At the object
instantiation, the current frame is the one at index 0. You can check at
any time which frame index is active:</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [7]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">hdmi</span><span class="o">.</span><span class="n">frame_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
Out[7]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
0
</pre></div>
</div>
</div>
<p>The frame_index() method can also be used to set a new index, if you
specify an argument with the method call. For instance:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [8]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">index</span> <span class="o">=</span> <span class="n">hdmi</span><span class="o">.</span><span class="n">frame_index</span><span class="p">()</span>
<span class="n">hdmi</span><span class="o">.</span><span class="n">frame_index</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This will set the current frame index to the next in the sequence.
However, if the index is 2 (the last frame in buffer), index+1 will
cause an exception. If you want to set the next frame in the sequence,
use:</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [9]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">hdmi</span><span class="o">.</span><span class="n">frame_index_next</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
Out[9]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
2
</pre></div>
</div>
</div>
<p>This will loop through the frame buffer and it will also return the new
index as an integer.</p>
<div class="section" id="Access-the-current-frame">
<h3>Access the current frame<a class="headerlink" href="#Access-the-current-frame" title="Permalink to this headline">¶</a></h3>
<p>There are two ways to access pixel data; <em>hdmi.frame()</em> and
<em>hdmi.frame_raw()</em></p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [10]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">Image</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">hdmi</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
<span class="n">orig_img_path</span> <span class="o">=</span> <span class="s">&#39;/home/xpp/jupyter_notebooks/Getting_Started/images/audiovideo_0.jpg&#39;</span>
<span class="n">frame</span><span class="o">.</span><span class="n">save_as_jpeg</span><span class="p">(</span><span class="n">orig_img_path</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">orig_img_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
Out[10]:
</pre></div>
</div>
<div class="container">
<img alt="_images/7_audio_video_overlay_21_0.jpg" src="_images/7_audio_video_overlay_21_0.jpg" />
</div>
</div>
<p>This will dump the frame as a python list <em>frame[height, width][rgb]</em>.
Where rgb is a tuple (r,g,b). If you want to modify the green component
of a pixel, you can do it as shown below. In the example, the top left
quarter of the image will have the green component increased.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [11]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)):</span>
        <span class="p">(</span><span class="n">red</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="n">blue</span><span class="p">)</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span>
        <span class="n">green</span> <span class="o">=</span> <span class="n">green</span><span class="o">*</span><span class="mi">2</span>
        <span class="k">if</span><span class="p">(</span><span class="n">green</span><span class="o">&gt;</span><span class="mi">255</span><span class="p">):</span>
            <span class="n">green</span> <span class="o">=</span> <span class="mi">255</span>
        <span class="n">frame</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">)</span>

<span class="n">new_img_path</span> <span class="o">=</span> <span class="s">&#39;/home/xpp/jupyter_notebooks/Getting_Started/images/audiovideo_1.jpg&#39;</span>
<span class="n">frame</span><span class="o">.</span><span class="n">save_as_jpeg</span><span class="p">(</span><span class="n">new_img_path</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">new_img_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
Out[11]:
</pre></div>
</div>
<div class="container">
<img alt="_images/7_audio_video_overlay_23_0.jpg" src="_images/7_audio_video_overlay_23_0.jpg" />
</div>
</div>
<p>This frame() method is a simple way to capture pixel data, but may be
slow. If you want to dump a frame at a specific index, just pass the
index as an argument of the frame() method:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [12]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">frame</span> <span class="o">=</span> <span class="n">hdmi</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># dumping frame at index 2</span>
</pre></div>
</div>
</div>
<p>If higher performance is required, the frame_raw() method can be used:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [13]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">frame_raw</span> <span class="o">=</span> <span class="n">hdmi</span><span class="o">.</span><span class="n">frame_raw</span><span class="p">()</span> <span class="c"># dumping frame at current index</span>
<span class="n">frame_raw</span> <span class="o">=</span> <span class="n">hdmi</span><span class="o">.</span><span class="n">frame_raw</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># dumping frame at index 2</span>
</pre></div>
</div>
</div>
<p>This method will return a fast memory dump of the internal frame buffer,
as a mono-dimensional list of dimension frame[1920<em>1080</em>3] (This
array is of fixed size regardless of the input source resolution).
1920x1080 is the maximum supported frame dimension and 3 separate values
for each pixel (Blue, Green, Red).</p>
<p>When the resolution is less than 1920x1080, the user must manually
extract the correct pixel data.</p>
<p>E.g. if the resolution of the video input source is 800x600:</p>
<p>In this example, meaningful values will only be in the range
frame_raw[1920<em>i</em>3] to frame_raw[(1920<em>i + 799)</em>3] for each i
(rows) from 0 to 599. Any other position outside of this range will
contain invalid data.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [14]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="nb">print</span><span class="p">(</span><span class="n">frame_raw</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c"># printing the green component of pixel (0,0)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">frame_raw</span><span class="p">[</span><span class="mi">1920</span> <span class="o">+</span> <span class="mi">399</span> <span class="o">+</span> <span class="mi">0</span><span class="p">])</span> <span class="c"># printing the blue component of pixel (1,399)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">frame_raw</span><span class="p">[</span><span class="mi">1920</span><span class="o">*</span><span class="mi">599</span> <span class="o">+</span> <span class="mi">799</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span> <span class="c"># printing the red component of the last pixel (599,799)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
0
0
70
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="The-VGA-video-display-controller">
<h2>The VGA video display controller<a class="headerlink" href="#The-VGA-video-display-controller" title="Permalink to this headline">¶</a></h2>
<p>Using the VGA controller is similar to using the HDMI. Connect the
on-board VGA port to a monitor, or other VGA display device.</p>
<p>To instantiate the VGA controller:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [15]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq.video</span> <span class="k">import</span> <span class="n">VGA</span>
<span class="n">vga</span> <span class="o">=</span> <span class="n">VGA</span><span class="p">(</span><span class="s">&#39;out&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For the VGA controller, you have to start/stop the device explicitly:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [16]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">vga</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [17]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">vga</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>To check the state of the controller:</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [18]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">state</span> <span class="o">=</span> <span class="n">vga</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<p>The state is returned as an integer value, with 2 possible values:</p>
<ul class="simple">
<li>0 if stopped</li>
<li>1 if running</li>
</ul>
<p>After initialization, the display resolution is set at the lowest level:
<a class="reference external" href="mailto:640x490&#37;&#52;&#48;60Hz">640x490<span>&#64;</span>60Hz</a>.</p>
<p>To check the current resolution:</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [19]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="nb">print</span><span class="p">(</span><span class="n">vga</span><span class="o">.</span><span class="n">mode</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
640x480@60Hz
</pre></div></div>
</div>
<p>This will print the current mode as a string. To change the mode, insert
a valid index as an argument when calling mode():</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [20]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">vga</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># 1280x720@60Hz</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
Out[20]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
&#39;1280x720@60Hz&#39;
</pre></div>
</div>
</div>
<p>Valid resolutions are:</p>
<ul class="simple">
<li>0 : <a class="reference external" href="mailto:'640x480&#37;&#52;&#48;60Hz">'640x480<span>&#64;</span>60Hz</a></li>
<li>1 : <a class="reference external" href="mailto:'800x600&#37;&#52;&#48;60Hz">'800x600<span>&#64;</span>60Hz</a></li>
<li>2 : <a class="reference external" href="mailto:'1280x720&#37;&#52;&#48;60Hz">'1280x720<span>&#64;</span>60Hz</a></li>
<li>3 : <a class="reference external" href="mailto:'1280x1024&#37;&#52;&#48;60Hz">'1280x1024<span>&#64;</span>60Hz</a></li>
<li>4 : <a class="reference external" href="mailto:'1920x1080&#37;&#52;&#48;60Hz">'1920x1080<span>&#64;</span>60Hz</a></li>
</ul>
<p>Similar to HDMI, you can access the current resolution width and height:</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [21]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">width</span> <span class="o">=</span> <span class="n">vga</span><span class="o">.</span><span class="n">frame_width</span><span class="p">()</span>
<span class="n">height</span> <span class="o">=</span> <span class="n">vga</span><span class="o">.</span><span class="n">frame_height</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&#39;VGA resolution is {}x{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
VGA resolution is 1280x720
</pre></div></div>
</div>
<p>and access the current frame, or change it using the same methods:</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [22]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">index</span> <span class="o">=</span> <span class="n">vga</span><span class="o">.</span><span class="n">frame_index</span><span class="p">()</span>
<span class="n">vga</span><span class="o">.</span><span class="n">frame_index</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">vga</span><span class="o">.</span><span class="n">frame_index_next</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
Out[22]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
0
</pre></div>
</div>
</div>
<p>Again, similar to the HDMI controller, frame() can be used to dump the
current frame content, or the frame at a specific index using
frame(index). The faster frame_raw() is also available.</p>
<p>To send a new frame to the VGA and display it, pass the new
<em>frame[height][width][rgb]</em> as an argument to <em>frame()</em> or your new
<em>frame_raw[1920*1080</em>3]* to <em>frame_raw()</em>. This will copy your new
frame content to the VGA’s frame buffer.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [23]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">vga</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="c"># copying new frame at current index</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [24]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">vga</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span> <span class="c"># copying new frame at index 2</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [25]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">vga</span><span class="o">.</span><span class="n">frame_raw</span><span class="p">(</span><span class="n">frame_raw</span><span class="p">)</span> <span class="c"># copying new frame_raw at current index</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [26]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">vga</span><span class="o">.</span><span class="n">frame_raw</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">frame_raw</span><span class="p">)</span> <span class="c"># copying new frame_raw at index 1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Frame-Buffers">
<h2>Frame Buffers<a class="headerlink" href="#Frame-Buffers" title="Permalink to this headline">¶</a></h2>
<p>To draw or display smooth animations/video, note the following:</p>
<p>Draw a new frame to a frame location not currently in use (an index
different to the current vga.frame_index()) . Once finished writing the
new frame, change the current frame index to the new frame index.</p>
</div>
<div class="section" id="Using-HDMI-and-VGA-in-combination">
<h2>Using HDMI and VGA in combination<a class="headerlink" href="#Using-HDMI-and-VGA-in-combination" title="Permalink to this headline">¶</a></h2>
<p>To use the HDMI and VGA to capture and display an image, make both the
HDMI and VGA share the same frame buffer. The frame buffer in both cases
can be accessed using the frame_buffer() method. You can make the two
object share the same frame buffer passing the first declared object&#8217;s
frame buffer as an argument of the second object’s constructor:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [27]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq</span> <span class="k">import</span> <span class="n">Overlay</span>
<span class="kn">from</span> <span class="nn">pynq.video</span> <span class="k">import</span> <span class="n">HDMI</span>
<span class="kn">from</span> <span class="nn">pynq.video</span> <span class="k">import</span> <span class="n">VGA</span>

<span class="c"># Download new bitstream with audiovideo IP</span>
<span class="n">Overlay</span><span class="p">(</span><span class="s">&quot;audiovideo.bit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>

<span class="c"># Initialize HDMI as an input device</span>
<span class="n">hdmi</span> <span class="o">=</span> <span class="n">HDMI</span><span class="p">(</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
<span class="n">vga</span> <span class="o">=</span> <span class="n">VGA</span><span class="p">(</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">hdmi</span><span class="o">.</span><span class="n">frame_buffer</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>or equivalently:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [ ]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">vga</span> <span class="o">=</span> <span class="n">VGA</span><span class="p">(</span><span class="s">&#39;out&#39;</span><span class="p">)</span>
<span class="n">hdmi</span> <span class="o">=</span> <span class="n">HDMI</span><span class="p">(</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">vga</span><span class="o">.</span><span class="n">frame_buffer</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The last step is to set the controllers:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [28]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">hdmi</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">vga</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Once this is done, you should see the input HDMI on the VGA output.
Remember, both objects must have the same active frame_index.
Initially, both frame indexes start at 0.</p>
</div>
<div class="section" id="Using-Audio-IO">
<h2>Using Audio IO<a class="headerlink" href="#Using-Audio-IO" title="Permalink to this headline">¶</a></h2>
<p>The overlay contains an audio controller that allows you to control both
the HPH output port and the Line In input port of the Zybo. To
instantiate the two objects:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [29]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq.audio</span> <span class="k">import</span> <span class="n">LineIn</span>
<span class="kn">from</span> <span class="nn">pynq.audio</span> <span class="k">import</span> <span class="n">Headphone</span>
<span class="n">headphone</span> <span class="o">=</span> <span class="n">Headphone</span><span class="p">()</span>
<span class="n">linein</span> <span class="o">=</span> <span class="n">LineIn</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Connect the Line In port to an audio source using a standard 3mm cable.
Connect earphones/speakers to the HPH. To do a simple pass-through from
input (Line In) to output (HPH) read the input, and write the value to
the output</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [30]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">audio_sample</span> <span class="o">=</span> <span class="n">linein</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&#39;left channel: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">audio_sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&#39;right channel: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">audio_sample</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
left channel: 12391825
right channel: 12393967
</pre></div></div>
</div>
<p>The content of <em>audio_sample</em> will be a tuple representing the read
values from the left and right channels [left, right]. The <em>Headphone</em>
expects data of the same type. You can either pass the input directly to
the output, carry out some processing on the data, or write your own
samples to hph():</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [31]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">15</span> <span class="c"># set end time to current time + 15 seconds</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">time_end</span><span class="p">:</span>
    <span class="n">audio_sample</span> <span class="o">=</span> <span class="n">linein</span><span class="p">()</span>
    <span class="n">headphone</span><span class="p">(</span><span class="n">audio_sample</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
Done
</pre></div></div>
</div>
<p>This example alternates muting the left channel or right channel every 2
seconds</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [32]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq.audio</span> <span class="k">import</span> <span class="n">LineIn</span>
<span class="kn">from</span> <span class="nn">pynq.audio</span> <span class="k">import</span> <span class="n">Headphone</span>
<span class="n">headphone</span> <span class="o">=</span> <span class="n">Headphone</span><span class="p">()</span>
<span class="n">linein</span> <span class="o">=</span> <span class="n">LineIn</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">15</span> <span class="c"># set end time to current time + 15 seconds</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">time_end</span><span class="p">:</span>
    <span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">)</span> <span class="o">=</span> <span class="n">linein</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">%</span><span class="k">4</span>)
    <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">headphone</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
Done
</pre></div></div>
</div>
<p>To switch back to the Pmod I/O overlay, we can do:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [ ]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq</span> <span class="k">import</span> <span class="n">Overlay</span>
<span class="n">Overlay</span><span class="p">(</span><span class="s">&quot;pmod.bit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="8_iop_code.html" class="btn btn-neutral float-right" title="IO Processors: Writing your own software" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="6_pmodio_overlay.html" class="btn btn-neutral" title="Peripherals and the Pmod I/O overlay" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Xilinx.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>