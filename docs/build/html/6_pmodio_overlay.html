

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Peripherals and the Pmod I/O overlay &mdash; Python on Zynq (Pynq) v1.0</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Python on Zynq (Pynq) v1.0" href="index.html"/>
        <link rel="next" title="Arduino IO Processor" href="6a_arduino_overlay.html"/>
        <link rel="prev" title="Programming Zybo’s onboard peripherals" href="5_programming_onboard_peripherals.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Python on Zynq (Pynq)
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1_pynq.html">Pynq Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_jupyter_notebook.html">Introduction to Jupyter Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_programming_in_python.html">Cortex-A9 programming in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_programming_onboard_peripherals.html">Programming Zybo&#8217;s onboard peripherals</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Peripherals and the Pmod I/O overlay</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Pmod-peripherals">Pmod peripherals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Supported-peripherals">Supported peripherals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Pmod-Connector">Pmod Connector</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Pmod-pin-numbers-and-assignment">Pmod pin numbers and assignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Pmod-Pin-configuration">Pmod Pin configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Pmod-Grove-Adapter">Pmod-Grove Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#IO-Processors">IO Processors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Zybo-Pmod-I/O-overlay">Zybo Pmod I/O overlay</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-Pmods-with-an-overlay">Using Pmods with an overlay</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Example:-Using-the-OLED-and-the-Ambient-Light-Sensor-(ALS)">Example: Using the OLED and the Ambient Light Sensor (ALS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Example:-Using-the-ADC,-DAC-and-OLED">Example: Using the ADC, DAC and OLED</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Going-further">Going further</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="6a_arduino_overlay.html">Arduino IO Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_audio_video_overlay.html">The Audio-Video Overlay</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_iop_code.html">IO Processors: Writing your own software</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_creating_overlays.html">Working with Overlays</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_libraries_and_overlays.html">The <code class="docutils literal"><span class="pre">Pynq</span></code> (Python on Zynq) Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_verification.html">Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_modules.html">pynq modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_faqs.html">Frequently Asked Questions (FAQs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_references.html">Useful Reference Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Python on Zynq (Pynq)</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Peripherals and the Pmod I/O overlay</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/6_pmodio_overlay.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<div class="section" id="Peripherals-and-the-Pmod-I/O-overlay">
<h1>Peripherals and the Pmod I/O overlay<a class="headerlink" href="#Peripherals-and-the-Pmod-I/O-overlay" title="Permalink to this headline">¶</a></h1>
<p>The Zybo has 6 <em>Peripheral Module</em> (Pmod) interfaces available on the
board. A Pmod interface is a 12-pin connector that can be used to
connect peripherals and other accessories to the board.</p>
<p>Pmod peripherals are available from <a class="reference external" href="http://www.digilentinc.com">Digilent
Inc</a> and other suppliers.</p>
<div class="section" id="Pmod-peripherals">
<h2>Pmod peripherals<a class="headerlink" href="#Pmod-peripherals" title="Permalink to this headline">¶</a></h2>
<div class="figure">
<img alt="" src="_images/Pmods_opt.png" />
</div>
<div class="section" id="Supported-peripherals">
<h3>Supported peripherals<a class="headerlink" href="#Supported-peripherals" title="Permalink to this headline">¶</a></h3>
<p>Pynq current supports a number of Pmods and Grove Peripherals. See the
<em>pynq.pmods package</em> section of the documentation.</p>
<p>Pmods can be plugged directly into the Pmod port. Grove Peripherals can
be connected to the Pmod Port through a
<a class="reference external" href="http://www.xess.com/shop/product/stickit-grove/">*StickIt*</a> adapter
board.</p>
<p>As the PMOD interface connects to FPGA pins, other peripherals can be
wired to a Pmod port.</p>
</div>
<div class="section" id="Pmod-Connector">
<h3>Pmod Connector<a class="headerlink" href="#Pmod-Connector" title="Permalink to this headline">¶</a></h3>
<p>Each Pmod connector has 12 pins (2 rows of 6 pins, where each row has
3.3V (VCC), ground (GND) and 4 data pins giving 8 data pins in total).</p>
<p><em>Close-up of a 12-pin Pmod</em></p>
<div class="figure">
<img alt="" src="_images/pmod_closeup_opt.jpeg" />
</div>
</div>
<div class="section" id="Pmod-pin-numbers-and-assignment">
<h3>Pmod pin numbers and assignment<a class="headerlink" href="#Pmod-pin-numbers-and-assignment" title="Permalink to this headline">¶</a></h3>
<div class="figure">
<img alt="" src="_images/pmod_pins_opt.png" />
</div>
<p>Note the Pmod data pins are labelled 0-7.</p>
</div>
<div class="section" id="Pmod-Pin-configuration">
<h3>Pmod Pin configuration<a class="headerlink" href="#Pmod-Pin-configuration" title="Permalink to this headline">¶</a></h3>
<p>Pmods come in different configurations depending on the number of data
pins required (single row, double row, e.g. 1x6 pins, 2x4 pins, 2x6
pins). Pmod peripherals with only a single row of pins can be plugged
into the top row or the bottom row of the Pmod connector.</p>
<p>Pmods that use both rows (e.g. 2x4 pins, 2x6 pins), should in general be
aligned to the upper-left of the connector (to align with VCC and GND).</p>
<div class="figure">
<img alt="" src="_images/tmp2_8pin_opt.jpeg" />
</div>
</div>
<div class="section" id="Pmod-Grove-Adapter">
<h3>Pmod-Grove Adapter<a class="headerlink" href="#Pmod-Grove-Adapter" title="Permalink to this headline">¶</a></h3>
<p>Each Grove connector has 4 pins, one each for VCC and GND leaving 2 pins
on each connector for signal wires. The Pmod-to-Grove StickIt adapter
has 4 connectors for Grove devices, GR1, GR2, GR3, GR4.</p>
<div class="figure">
<img alt="" src="_images/Pmod_Grove_Adapter_opt.jpeg" />
</div>
<p>All pins operate at 3.3V. Due to different pull-up/pull-down I/O
requirements for different peripherals (e.g. IIC requires pull-up, and
SPI requires pull-down), Grove peripherals must be plugged into the
appropriate connector.</p>
<p>GR 1 and 2 pins are connected to pins with pull-down resistors, and GR3
and GR4 are connected to pins with pull-up resistors, as indicated in
the image. This doesn&#8217;t affect Pmods.</p>
<div class="figure">
<img alt="" src="_images/stickit_mapping_opt.jpg" />
</div>
</div>
</div>
<div class="section" id="IO-Processors">
<h2>IO Processors<a class="headerlink" href="#IO-Processors" title="Permalink to this headline">¶</a></h2>
<p>For overlays to be useful, they must provide sufficient functionality,
while also providing flexibility to suit a wide range of applications.
Flexibility in the overlay is provided through IO Processors (IOPs). An
IO Processor is implemented in the Programmable Logic (PL or FPGA
fabric) and consists of a MicroBlaze processor, Memory, Timer, IIC, SPI,
GPIO, Debug logic and a configurable switch.</p>
<div class="figure">
<img alt="" src="_images/iop.jpg" />
</div>
<p>The IOP gives flexibility to connect to and control a range of different
external accessories without requiring a re-design of the FPGA hardware.
The IOP can be used to control a Pmod port, or other interface, or to
off-load applications from the main ARM processors in the Zynq PS.</p>
<p>Each IOP has a dedicated memory block for the MicroBlaze instruction and
data memory. This memory block is dual-ported, with one port connected
to the MicroBlaze, and the other connected to the Cortex-A9 processor.
This allows the ARM processor to access the MicroBlaze memory and
dynamically write a new program to the MicroBlaze instruction area. The
data area can be used for communication and data transfer between the
ARM processor and the IOP(s).</p>
<p>Currently, one IOP is dedicated to each Pmod port. Inside the IOP are
dedicated interface blocks; Timer, IIC, SPI and GPIO (General Purpose
Input/Output). IIC and SPI are specialized interfaces used by many of
the available Pmod, Grove and other peripherals, and GPIO can be used to
connect to custom interfaces or used as simple inputs and outputs. When
a Pmod or other peripheral is plugged in to a port, the configurable
switch allows the Pmod signals to be routed internally to the required
interface block.</p>
</div>
<div class="section" id="Zybo-Pmod-I/O-overlay">
<h2>Zybo Pmod I/O overlay<a class="headerlink" href="#Zybo-Pmod-I/O-overlay" title="Permalink to this headline">¶</a></h2>
<p>The Zybo has 6 Pmod connectors. Ports 1-4 as indicated below are
connected the Zynq PL. XADC and JF are not included/connected in this
overlay.</p>
<div class="figure">
<img alt="" src="_images/zybopmods_opt.jpeg" />
</div>
<p>The Pmod I/O overlay for the Zybo contains 4 IOPs each connected to one
of the PL Pmod ports. This allows control of the Pmod from Python, via
the IOP.</p>
<div class="figure">
<img alt="" src="_images/pmodio_overlay_1_opt.png" />
</div>
</div>
<div class="section" id="Using-Pmods-with-an-overlay">
<h2>Using Pmods with an overlay<a class="headerlink" href="#Using-Pmods-with-an-overlay" title="Permalink to this headline">¶</a></h2>
<p>To use a peripheral two software components are required; a driver
application written in C for the IOP, and a Python module. These
components are provided as part of the Pynq pacakge for supported
peripherals. See the <em>IO Processors: Writing your own software</em> section
of the documentation for writing drivers for your own periphals.</p>
<p>The Python module instantiates the peripheral, and loads the driver
application to the appropriate IOP. The IOP will also be reset and start
executing the new application.</p>
<p>The Python module will send commands which the IOP, and read and write
data from the shared memory area.</p>
</div>
<div class="section" id="Example:-Using-the-OLED-and-the-Ambient-Light-Sensor-(ALS)">
<h2>Example: Using the OLED and the Ambient Light Sensor (ALS)<a class="headerlink" href="#Example:-Using-the-OLED-and-the-Ambient-Light-Sensor-(ALS)" title="Permalink to this headline">¶</a></h2>
<p>This examples requires the PmodOLED (OLED), and PmodALS (Ambient Light
Sensor). Plug the PmodOLED into Port 1, and PmodALS into the top row of
Port 2. (Currently, the PmodALS can only be used in the top row of a
Pmod port.)</p>
<p>OLED displaying light reading from ambient light sensor:</p>
<div class="figure">
<img alt="" src="_images/als_oled_Demo_opt.jpeg" />
</div>
<p>Execute the next cell to load the FPGA Overlay, and then import the OLED
module and instantiate it on port 1/IOP 1:</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [1]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq</span> <span class="k">import</span> <span class="n">Overlay</span>
<span class="kn">from</span> <span class="nn">pynq.pmods</span> <span class="k">import</span> <span class="n">PMOD_OLED</span>
<span class="n">ol</span> <span class="o">=</span> <span class="n">Overlay</span><span class="p">(</span><span class="s">&quot;pmod.bit&quot;</span><span class="p">)</span>
<span class="n">ol</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
<span class="n">oled</span> <span class="o">=</span> <span class="n">PMOD_OLED</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Try writing a message to the OLED.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [2]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">oled</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [3]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">oled</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Import the ALS library, create an instance of the ALS Pmod, and read the
value from the sensor</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [4]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq.pmods</span> <span class="k">import</span> <span class="n">PMOD_ALS</span>
<span class="n">als</span> <span class="o">=</span> <span class="n">PMOD_ALS</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">als</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
Out[4]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
47
</pre></div>
</div>
</div>
<p>Write the value from the ALS to the OLED. The ALS sensor returns an
8-bit value. 0 = Darkest, 255 = Brightest</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [5]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="n">oled</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Light value : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">als</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [6]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq.pmods</span> <span class="k">import</span> <span class="n">PMOD_ALS</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">als</span> <span class="o">=</span> <span class="n">PMOD_ALS</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">als</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">als</span><span class="o">.</span><span class="n">set_log_interval_ms</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="n">als</span><span class="o">.</span><span class="n">start_log</span><span class="p">()</span> <span class="c"># start logging values at intervals of delay</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">als</span><span class="o">.</span><span class="n">stop_log</span><span class="p">()</span>
<span class="n">als</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
Out[6]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
[41, 33, 32, 32, 32, 16, 31, 31, 31, 31, 30]
</pre></div>
</div>
</div>
</div>
<div class="section" id="Example:-Using-the-ADC,-DAC-and-OLED">
<h2>Example: Using the ADC, DAC and OLED<a class="headerlink" href="#Example:-Using-the-ADC,-DAC-and-OLED" title="Permalink to this headline">¶</a></h2>
<p>This example requires the PmodAD2 (Analog to Digital Converter), PmodDA4
(Digital to Analog Converter) and PmodOLED (OLED). You will connect the
output of the DAC to the input of the ADC, write a value to the DAC
which the ADC will measure, and finally, write the value to the OLED for
display.</p>
<ul class="simple">
<li>Set the jumper (JP1) on the PmodAD2 to Ref</li>
</ul>
<p>Insert the following Pmods: * DAC to Port 1 (Top Row) * ADC to Port 2
(Align to the left of the port) * OLED to Port 4</p>
<ul class="simple">
<li>Connect a wire from PmodA4, pin: A to PmodAD2, pin: V1</li>
</ul>
<div class="figure">
<img alt="" src="_images/adc_dac_demo_opt.jpeg" />
</div>
<p>Execute the cell below. Note that if you executed the cells above, you
already loaded the overlay. However, it is good practice to load your
overlay at the start of your code each time.</p>
<p>You can set a different DAC output voltae by modifying the value in the
cell below (must be between 0 and 2.0) and executing the cell again. The
return value from the ADC and displayed on the LED is the measured
value. There may be some small error between this and the value written
to the DAC.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [7]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">pynq.pmods</span> <span class="k">import</span> <span class="n">PMOD_OLED</span><span class="p">,</span> <span class="n">PMOD_ADC</span><span class="p">,</span> <span class="n">PMOD_DAC</span>
<span class="kn">from</span> <span class="nn">pynq</span> <span class="k">import</span> <span class="n">Overlay</span>
<span class="n">ol</span> <span class="o">=</span> <span class="n">Overlay</span><span class="p">(</span><span class="s">&quot;pmod.bit&quot;</span><span class="p">)</span>
<span class="n">ol</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>

<span class="n">dac</span> <span class="o">=</span> <span class="n">PMOD_DAC</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">adc</span> <span class="o">=</span> <span class="n">PMOD_ADC</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">oled</span> <span class="o">=</span> <span class="n">PMOD_OLED</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">dac</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span> <span class="c"># Set the DAC output voltage</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c"># Measure output of DAC with ADC</span>
<span class="n">oled</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="c"># Display measured value on OLED</span>
</pre></div>
</div>
</div>
<p>For information on other supported peripherals and their API, see the
<em>Pmods pynq.pmods package</em> section of the documentation.</p>
</div>
<div class="section" id="Going-further">
<h2>Going further<a class="headerlink" href="#Going-further" title="Permalink to this headline">¶</a></h2>
<p>Scripts can be created and executed from the notebook.</p>
<p>In this example, the code below should be copied to a script and saved
on the board.</p>
<ul class="simple">
<li>In the Pynq Portal home area <a class="reference external" href="http://pynq:9090">pynq:9090</a> go to
the <em>Getting Started</em> folder and select New &gt; Text File (which opens
in a new window)</li>
<li>Copy and paste the code below into the file</li>
<li>Rename the file dac_loop.py (File &gt; Rename), and save it (File
Rename).</li>
<li>In the Pynq portal Getting_Started folder verify the file exists</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pynq</span> <span class="kn">import</span> <span class="n">Overlay</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="c">#### dac_loop.py</span>
<span class="k">def</span> <span class="nf">dac_loop</span><span class="p">(</span><span class="n">DAC_Port</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ADC_Port</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">OLED_Port</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">Switch_nmbr</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">delay_secs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    DAC -&gt; ADC -&gt; OLED -- LOOP OVER 10 Values</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ol</span> <span class="o">=</span> <span class="n">Overlay</span><span class="p">(</span><span class="s">&quot;pmod.bit&quot;</span><span class="p">)</span>
    <span class="n">ol</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
    <span class="c"># Import PMOD classes from library PythonXilinx (pynq.pmods)</span>
    <span class="kn">from</span> <span class="nn">pynq.pmods</span> <span class="kn">import</span> <span class="n">PMOD_OLED</span><span class="p">,</span> <span class="n">PMOD_ADC</span><span class="p">,</span> <span class="n">PMOD_DAC</span>

    <span class="kn">from</span> <span class="nn">pynq.board</span> <span class="kn">import</span>  <span class="n">LED</span><span class="p">,</span> <span class="n">Switch</span>

    <span class="c"># Match PMOD instances to PMOD Connectors</span>

    <span class="c"># Instantiate OLED</span>
    <span class="n">oled</span> <span class="o">=</span> <span class="n">PMOD_OLED</span><span class="p">(</span><span class="n">OLED_Port</span><span class="p">)</span>

    <span class="c"># Instantiate Digital to Analog Converter</span>
    <span class="n">dac</span> <span class="o">=</span> <span class="n">PMOD_DAC</span><span class="p">(</span><span class="n">DAC_Port</span><span class="p">)</span>

    <span class="c"># Instantiate Analog to Digital Converter</span>
    <span class="n">adc</span> <span class="o">=</span> <span class="n">PMOD_ADC</span><span class="p">(</span><span class="n">ADC_Port</span><span class="p">)</span>

    <span class="n">LED</span><span class="p">(</span><span class="n">Switch_nmbr</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">Switch</span><span class="p">(</span><span class="n">Switch_nmbr</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Switch 3 is off. To run the loop, set Switch 3 to on before running&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Turn Switch 3 off to stop the program&quot;</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">Switch</span><span class="p">(</span><span class="n">Switch_nmbr</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">():</span>
        <span class="n">LED</span><span class="p">(</span><span class="n">Switch_nmbr</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
            <span class="n">dac</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">measured</span> <span class="o">=</span> <span class="n">adc</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Measurement {} equals: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">measured</span><span class="p">))</span>
            <span class="n">oled</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">measured</span><span class="p">))</span>
    <span class="n">LED</span><span class="p">(</span><span class="n">Switch_nmbr</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, the DAC is be connected to Port 1 (Top Row), the ADC is
connected to Port 2, and OLED is connected to Port 4. The function reads
<em>Switch</em> 3 on the board. If the switch is on, it will run a loop that
writes to the DAC, reads the value on the ADC and writes to the OLED.
This is the same functionality as the previous example, but this time
executing from a script, and inside a loop controlled by a switch.</p>
<p>Set Switch 3 on the board to &#8220;on&#8221; (or up), and then execute the cell
below. This will run the script which will load the dac_loop() function
into the notebook, and then execute the dac_loop() function in the cell
below. You can change the ports the Pmods are attached to by passing the
port numbers as parameters to the function.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [4]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span class="o">%</span><span class="k">run</span> dac_loop.py
<span class="n">dac_loop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
Turn Switch 3 off to stop the program
Measurement 1 equals: 0.1016
Measurement 2 equals: 0.1953
Measurement 3 equals: 0.3047
Measurement 4 equals: 0.3984
Measurement 5 equals: 0.4922
Measurement 6 equals: 0.5898
Measurement 7 equals: 0.6836
Measurement 8 equals: 0.7773
Measurement 9 equals: 0.8711
Measurement 10 equals: 1.0078
</pre></div></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="6a_arduino_overlay.html" class="btn btn-neutral float-right" title="Arduino IO Processor" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="5_programming_onboard_peripherals.html" class="btn btn-neutral" title="Programming Zybo’s onboard peripherals" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Xilinx.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>